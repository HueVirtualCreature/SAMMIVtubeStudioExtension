[extension_name]
SAMMIVTubeStudioExtension

[extension_info]
Written by Hue_vCreature, the Centipede Youkai

[insert_external]
<style type="">
  * {
      box-sizing: border-box;
    }
</style>

<div class="row">
  <p>SAMMIVtubeStudioExtension: Interfaces SAMMI with Denchisoft's VTubeStudio by invoking endpoints on the VTubeStudio API via Commands</p>
</div>
<div class="row">
  <div class="column">
    <img class="hue-img" src="https://i.imgur.com/PXr3Lez.png"></img>
  </div>
  <div class="column">
    <p>Created by Hue, the Centipede Youkai</p> 
    <a href="https://hue-centipedeyokai.carrd.co/">My Carrd!</a>
    <a href="https://github.com/HueVirtualCreature/SAMMIVtubeStudioExtension">Instructions and Readme</a>
    <p>You may access the commands under Extension Commands > SAMMI Bridge > VTubeStudio*</p>
    <p>Please keep in mind that the Bridge MUST BE OPEN in order for any of its commands to work.</p>
    <p>Version: $!BUILDNUMBER!$</p>
	<button class="btn btn-primary btn-sm" onclick="requestRefresh();">Refresh Model and Hotkey Lists</button>
  </div>
</div>

[insert_command]
SAMMIVTS_initialize();

[insert_hook]

[insert_script]
const VTUBESTUDIO_SERVER = 'ws://127.0.0.1:8001';
const VTUBESTUDIO_PLUGINNAME = "SAMMIVtubeStudioExtension";
const VTUBESTUDIO_AUTHORNAME = "Hue_vCreature";
const VTUBESTUDIO_PLUGIN_ICON64 = `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`;

VTUBESTUDIO_WebSocket_ReadyStates = { CONNECTING: 0, OPEN: 1, CLOSING: 2, CLOSED: 3 };

//#region Insert Commands
//Inserts base extension commands into SAMMI
//TODO Move to private space
function SAMMIVTS_insertBaseCommands() {
	const saveAsVariableBox = ["Save Variable As", 14, ""]

	const vtsStatsProps = ["*leave blank to save entire response*","uptime","framerate","vTubeStudioVersion","allowedPlugins",
	"connectedPlugins","startedWithSteam","windowWidth","windowHeight","windowIsFullscreen",];

	const commonModelDataProps = ["*leave blank to save entire response*","modelID", "modelName", "modelPosition", "positionX", 
	"positionY", "size", "rotation", "modelLoaded", "modelLoadTime", "hasPhysicsFile", "timeSinceModelLoaded"];

	SAMMI.extCommand("VtubeStudio - Send Hotkey",3355443, 52, {
		Hotkey: ['Hotkey', 20, "Please make a selection", null, ["No Hotkeys! (Did you authenticate?)"]]
	});

	SAMMI.extCommand("VtubeStudio - Send Hotkey (By Name)",3355443, 52, {
		HotkeyName: ['Hotkey Name', 14, ""]
	});

	SAMMI.extCommand("VtubeStudio - Send Hotkey (Item)",3355443, 52, {
		InstanceID: ['Item InstanceID', 14, "", null],
		Hotkey: ['Hotkey', 14, "", null]
	});

	SAMMI.extCommand("VtubeStudio - Load Model",3355443, 52, { 
		Model: ['Model to Load', 20, "Please make a selection", null, ["No Models! (Did you authenticate?)"]]
	})

	//This is used to trigger the initial authentication
	SAMMI.extCommand("VtubeStudio - Request Token",3355443, 52, {
		//Token: ["Save Token to Variable", 14, ""] //When the server responds with the auth token, save to global OR user-defined variable
		dev_note: ["Dev Note", 0, "This is used to request a token from vTubestudio. The server will return with a token and save that to a global variable"]
	});

	//This is used to trigger the initial authentication
	SAMMI.extCommand("VtubeStudio - Authenticate",3355443, 52, {
		//Token: ["Save Token to Variable", 14, ""] //When the server responds with the auth token, save to global OR user-defined variable
		dev_note: ["Dev Note", 0, "This is used to authenticate with vTubestudio. The auth state will be saved to global"]
	});

	SAMMI.extCommand("VtubeStudio - Move Model",3355443, 52, {
		//Need better default values
		positionX: ["PositionX", 14, "0"],
		positionY: ["PositionY", 14, "0"],
		size: ["Size", 14, "-50.0"],
		rotation: ["Rotation", 14, "360"],
		time: ["Time (0-2)", 14, "0.5"],
		relative: ["Relative Values", 2, false],
		dev_note: ["Dev Note", 0, "This one doesn't work super \nwell mainly because you have to \ndo a lot of trial and error to get \nthe numbers just right....\ngood luck! Changing the \ncontents of this textbox \ndoes nothing, by the way."]
	 });
	
	
	SAMMI.extCommand("VtubeStudio - Pull Value",3355443, 52, {
		PullValue: ["Pull Value", 20, "", null, commonModelDataProps],
		Global: ["Global", 2, false],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - Get Items List",3355443, 80, {
		includeAvailableSpots: ["includeAvailableSpots", 2, false],
		includeItemInstancesInScene: ["includeItemInstancesInScene", 2, false],
		includeAvailableItemFiles: ["includeAvailableItemFiles", 2, false],
		onlyItemsWithFileName: ["onlyItemsWithFileName", 14, ""],
		onlyItemsWithInstanceID: ["onlyItemsWithInstanceID", 14, ""],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - Load Item",3355443, 80, {
		fileName: ["fileName", 14, ""],
		positionX: ["positionX", 14, "0"],
		positionY: ["positionY", 14, "0.5"],
		size: ["size", 14, "0.33"],
		rotation: ["rotation", 14, "90"],
		fadeTime: ["fadeTime", 14, "0.5"],
		order: ["order", 14, "4"],
		failIfOrderTaken: ["failIfOrderTaken", 2, false],
		smoothing: ["smoothing", 14, "0.5"],
		censored: ["censored", 2, false],
		flipped: ["flipped", 2, false],
		locked: ["locked", 2, false],
		unloadWhenPluginDisconnects: ["unloadWhenPluginDisconnects", 2, true],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - Remove Item",3355443, 80, {
		unloadAllInScene: ["Remove All in Scene", 2, false],
		unloadAllLoadedByThisPlugin: ["Remove All (by SAMMI)", 2, false],
		allowUnloadingItemsLoadedByUserOrOtherPlugins: ["Allow Removal of Items (by other than SAMMI)", 2, true],
		instanceIDs: ["instanceIDs ArrayName", 14, ""],
		fileNames: ["fileNames ArrayName", 14, ""],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - Control Animation",3355443, 80, {
		itemInstanceID: ["itemInstanceID", 14, ""],
		framerate: ["framerate", 14, "12"],
		frame: ["frame", 14, "0"],
		brightness: ["brightness", 14, "1"],
		opacity: ["opacity", 14, "1"],
		setAutoStopFrames: ["setAutoStopFrames", 2, false],
		autoStopFrames: ["autoStopFrames", 14, ""],
		setAnimationPlayState: ["setAnimationPlayState", 2, true],
		animationPlayState: ["animationPlayState", 2, true],
		variable: saveAsVariableBox //Not used
	});

	//TODO Move Items UI needs to be improved to be more user friendly
	SAMMI.extCommand("VtubeStudio - Move Item",3355443, 80, {
		itemsToMove: ["itemsToMove Variable Name", 14, ""],
		//TODO This sucks ass
		dev_note: ["Request model", 0, `{\n"itemInstanceID": "ItemInstanceId",\n"timeInSeconds": 1,\n"fadeMode": "easeOut",\n"positionX": 0.2,\n"positionY": -0.8,\n"size": 0.6,\n"rotation": 180,\n"order": -1000,\n"setFlip": true,\n"flip": false,\n"userCanStop": true\n}`],
		variable: saveAsVariableBox //Not used
	});

	SAMMI.extCommand("VtubeStudio - PostProcessing List Get (BETA)",3355443, 80, {
		fillPostProcessingPresetsArray: ["Include Presets?", 2, false, 0.5],
		fillPostProcessingEffectsArray: ["Include VFX?", 2, false, 0.5],
		effectIDFilter: ["effectIDFilter (array name or blank)", 14, "", 1.5],
		variable: ["Save Variable As", 14, "", 1.5]
	});

	SAMMI.extCommand("VtubeStudio - PostProcessing Simple On/Off (BETA)",3355443, 30, {
		postProcessingOn: ["On/Off", 14, "", 0.5],
		variable: ["Save Variable As", 14, "", 1.5]
	});

	const postProcessingEffects = [
		"ColorGrading","WeatherEffects","Bloom","Backlight","CustomParticles","BackgroundShift","SimpleOverlay",
		"Vignette","ChromaticAberration","OldFilm","Lowfps","Datamosh","LineScanner","ParticleShower","AnalogGlitch",
		"DigitalGlitch","Letterbox","FoggyWindow","Speedlines","Pixelation","LensDistortion","WaveDistortion","BlurEffects",
		"Grain","Vhs","Outline","Posterize","Ascii","ModelGlitch"
	]
	//https://github.com/DenchiSoft/VTubeStudio/blob/master/Files/EffectConfigs.cs
	SAMMI.extCommand("VtubeStudio - PostProcessing - Helper - Add Effect to Array (BETA)",3355443, 30, {
		effectName: ["Effect to add to array", 20, "", 0.8, postProcessingEffects],
		variable: ["Array Name", 14, "",0.8],
		dev_note: ["Note", 0, "The array is not updated right away. \nYou may need to wait. \nAlso useful as a reference.", 1.4]
	});

	const postProcessingConfigTypes = ["ColorGrading_Strength","ColorGrading_HueShift","ColorGrading_Saturation","ColorGrading_Brightness","ColorGrading_Contrast","ColorGrading_ColorFilter","ColorGrading_WhitebalanceTemperature","ColorGrading_WhitebalanceTint","ColorGrading_Invert","WeatherEffects_RainStrength","WeatherEffects_SnowStrength","WeatherEffects_RainInFront","WeatherEffects_SnowInFront","Bloom_Strength",
		"Bloom_ModelColorDarken","Bloom_BackgroundColorDarken","Bloom_MainThreshold","Bloom_MainIntensity","Bloom_MainColorTint","Bloom_StreakThreshold","Bloom_StreakIntensity","Bloom_StreakColorTint","Bloom_StreakVertical","Bloom_MicIncreasesBloom","Bloom_Quality","Backlight_Strength","Backlight_BgBlurOverModel","Backlight_BgBlurOverBg","Backlight_DarkenModel",
		"Backlight_DarkenBg","Backlight_StrengthNormal","Backlight_StrengthDirectional","Backlight_BrightnessLimit","Backlight_BacklightDirection","Backlight_BacklightBothDirections","Backlight_BacklightSoftness","Backlight_BacklightColorTint","Backlight_BacklightColorFromBg","Backlight_OutlineSize","Backlight_OutlineColorMain","Backlight_OutlineColorStripes","Backlight_OutlineStripeCount",
		"Backlight_OutlineStripeSpeed","Backlight_OutlineStripeCurve","Backlight_ShadowMainColor","Backlight_ShadowOffsetX","Backlight_ShadowOffsetY","CustomParticles_Strength","CustomParticles_BaseMoveWithHead","CustomParticles_SparkleStrength","CustomParticles_SparkleSize","CustomParticles_SparkleColorA","CustomParticles_SparkleColorB","CustomParticles_FloatyStrength",
		"CustomParticles_FloatySize","CustomParticles_FloatyColorA","CustomParticles_FloatyColorB","CustomParticles_CloudStrength","CustomParticles_CloudSize","CustomParticles_CloudColorA","CustomParticles_CloudColorB","CustomParticles_SphereStrength","CustomParticles_SphereSize","CustomParticles_SphereColorA","CustomParticles_SphereColorB","CustomParticles_HeartsStrength","CustomParticles_HeartsSize","CustomParticles_HeartsColorA",
		"CustomParticles_HeartsColorB","CustomParticles_Custom1TextureFile","CustomParticles_Custom1ColorA","CustomParticles_Custom1ColorB","CustomParticles_Custom1MaterialTypeId","CustomParticles_Custom1InBack","CustomParticles_Custom1MoveWithHead","CustomParticles_Custom1Size","CustomParticles_Custom1Amount","CustomParticles_Custom1FillToCenter","CustomParticles_Custom1BaseRotation","CustomParticles_Custom1RotationSpeed","CustomParticles_Custom1MoveFasterMicVol",
		"CustomParticles_Custom2TextureFile","CustomParticles_Custom2ColorA","CustomParticles_Custom2ColorB","CustomParticles_Custom2MaterialTypeId","CustomParticles_Custom2InBack","CustomParticles_Custom2MoveWithHead","CustomParticles_Custom2Size","CustomParticles_Custom2Amount","CustomParticles_Custom2FillToCenter","CustomParticles_Custom2BaseRotation","CustomParticles_Custom2RotationSpeed","CustomParticles_Custom2MoveFasterMicVol","BackgroundShift_Strength",
		"BackgroundShift_ZoomIn","BackgroundShift_MicZoomIn","BackgroundShift_TrackingX","BackgroundShift_TrackingY","BackgroundShift_TrackingSmoothing","BackgroundShift_RandomMovementX","BackgroundShift_RandomMovementY","BackgroundShift_RandomMovementRotation","BackgroundShift_RandomMovementSpeed","BackgroundShift_BlurMixBack","BackgroundShift_BlurMainBack","BackgroundShift_BlurBrightnessBack",
		"BackgroundShift_BlurMixFront","BackgroundShift_BlurMainFront","BackgroundShift_BlurBrightnessFront","SimpleOverlay_Strength","SimpleOverlay_TextureFile","SimpleOverlay_ZoomIn","SimpleOverlay_TrackingX","SimpleOverlay_TrackingY","SimpleOverlay_TrackingSmoothing","SimpleOverlay_RandomMovementX","SimpleOverlay_RandomMovementY",
		"SimpleOverlay_RandomMovementRotation","SimpleOverlay_RandomMovementSpeed","SimpleOverlay_TintColor","Vignette_Strength","Vignette_Smoothness","Vignette_Color","Vignette_CenterX","Vignette_CenterY","Vignette_Roundness","Vignette_Circular",
		"ChromaticAberration_Strength","ChromaticAberration_BlurEdges","OldFilm_Strength","OldFilm_FilmFps","OldFilm_FilmContrast","OldFilm_FilmBurn","OldFilm_FilmSceneCut","Lowfps_Strength","Lowfps_FpsLimit","Lowfps_FpsRandom","Lowfps_ScreenTearing",
		"Datamosh_Strength","Datamosh_Size","Datamosh_ResetAfterSecs","Datamosh_Entropy","Datamosh_NoiseContrast","Datamosh_VelocityScale","Datamosh_Diffusion","LineScanner_Strength","LineScanner_Direction","LineScanner_ScanStepTotal","LineScanner_ScanStepSize","LineScanner_ScanLineColor","LineScanner_ScanLineSize","LineScanner_ScanLineWaitBetweenScansSecs","ParticleShower_Strength","ParticleShower_TextureFile1",
		"ParticleShower_TextureFile2","ParticleShower_TextureFile3","ParticleShower_Speed1","ParticleShower_Speed2","ParticleShower_Speed3","ParticleShower_InBack1","ParticleShower_InBack2","ParticleShower_InBack3","AnalogGlitch_Strength","AnalogGlitch_ScanlineJitter","AnalogGlitch_VerticalJump","AnalogGlitch_HorizontalShake","AnalogGlitch_ColorDrift","AnalogGlitch_MicEffect",
		"DigitalGlitch_Strength","DigitalGlitch_Colorshift","DigitalGlitch_MicEffect","Letterbox_Strength","Letterbox_ProgressY","Letterbox_ProgressX","Letterbox_Zoom","Letterbox_Color","FoggyWindow_Strength","FoggyWindow_FogStrength","FoggyWindow_FogTint","FoggyWindow_FogBoost","FoggyWindow_RaindropVisibility","FoggyWindow_RaindropSpeed","FoggyWindow_RaindropSize","FoggyWindow_FogWipeSize","FoggyWindow_FogWipeLifetimeSeconds",
		"FoggyWindow_FogLifetimeInfinite","Speedlines_Strength","Speedlines_XCenter","Speedlines_YCenter","Speedlines_ColorA","Speedlines_ColorB","Speedlines_MicEffect","Pixelation_Strength","Pixelation_Resolution","Pixelation_Colorize","Pixelation_C1","Pixelation_C2","Pixelation_C3","Pixelation_C4",
		"Pixelation_C5","Pixelation_C6","Pixelation_C7","Pixelation_C8","Pixelation_Fry","LensDistortion_Strength","LensDistortion_LensStrength","LensDistortion_ZoomIn","LensDistortion_Squish","WaveDistortion_Strength","WaveDistortion_HeatStrength","WaveDistortion_RaindropStrength","WaveDistortion_RaindropFrequency","WaveDistortion_ZoomIn",
		"WaveDistortion_RotationBase","WaveDistortion_WaveXStrength","WaveDistortion_WaveXScroll","WaveDistortion_WaveXFrequency","WaveDistortion_WaveYStrength","WaveDistortion_WaveYScroll","WaveDistortion_WaveYFrequency","BlurEffects_Strength","BlurEffects_BasicBlurVisibility","BlurEffects_BasicBlurStrength","BlurEffects_PixelationBlur","BlurEffects_MotionBlur","Grain_Strength","Grain_Size",
		"Grain_Luminosity","Grain_Colored","Vhs_Strength","Vhs_Fisheye","Vhs_Vignette","Vhs_ScreenBleed","Vhs_NoiseGrain","Vhs_NoiseLines","Vhs_TwitchVertical","Vhs_TwitchHorizontal","Vhs_Interlacing","Vhs_GammaCorrection","Vhs_PaleColor",
		"Vhs_AfterImageAmount","Vhs_AfterImageColor","Outline_Strength","Outline_Sharpen","Outline_Visibility","Outline_Color","Outline_Threshold","Outline_Contrast","Posterize_Strength","Ascii_Strength","Ascii_Size","Ascii_CharacterVisibility","Ascii_CharacterColorStrength","Ascii_CharacterColor",
		"ModelGlitch_StrengthExplode","ModelGlitch_StrengthWiggle","ModelGlitch_StrengthPulse","ModelGlitch_StrengthLiquify"];

	SAMMI.extCommand("VtubeStudio - PostProcessing - Helper - Create Config Object (BETA)",3355443, 30, {
		"configID": ["Config Name", 20, "", null, postProcessingConfigTypes],//"Backlight_Strength",
		"configValue": ["Config Value", 14, ""],//"0.8"
		variable: saveAsVariableBox
	});

	//https://github.com/DenchiSoft/VTubeStudio/blob/master/Files/EffectConfigs.cs
	SAMMI.extCommand("VtubeStudio - PostProcessing Set (BETA)",3355443, 30, {
		postProcessingOn: ["On/Off", 14, ""], //NOTE /$variable$/ works!
		postProcessingFadeTime: ["Fade (sec)", 14, ""],
		setAllOtherValuesToDefault: ["Set Missing to Default", 2, false],
		usingRestrictedEffects: ["Allow Restricted VFX", 2, false],
		randomizeAll: ["Randomize", 2, false],
		randomizeAllChaosLevel: ["Chaos Level", 11, false],
		postProcessingValues: ["Config Array", 14, ""],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - PostProcessing Set by Preset(BETA)",3355443, 30, {
		postProcessingOn: ["On/Off", 14, ""], //NOTE /$variable$/ works!
		postProcessingFadeTime: ["Fade (sec)", 14, ""],
		presetToSet: ["Preset Name", 14, ""],
		setAllOtherValuesToDefault: ["Set Missing to Default", 2, false],
		usingRestrictedEffects: ["Allow Restricted VFX", 2, false],
		randomizeAll: ["Randomize", 2, false],
		randomizeAllChaosLevel: ["Chaos Level", 11, false],
		postProcessingValues: ["Config Array", 14, ""],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - Get VTS Info",3355443, 30, {
		variable: saveAsVariableBox,
		pullValue: ["Pull Value", 20, "", null, vtsStatsProps],
	});

	const events = [ "TestEvent","ModelLoadedEvent","TrackingStatusChangedEvent","BackgroundChangedEvent","ModelConfigChangedEvent",
	"ModelMovedEvent","ModelOutlineEvent"];

	SAMMI.extCommand("VtubeStudio - Listen to Event",3355443, 80, {
		Event: ["Event", 20, "", null, events],
		variable: saveAsVariableBox
	});

	SAMMI.extCommand("VtubeStudio - Unsubscribe from Event",3355443, 80, {
		Event: ["Event", 20, "", null, events],
		variable: saveAsVariableBox
	});

	//ExpressionStateRequest
	//https://github.com/DenchiSoft/VTubeStudio#requesting-current-expression-state-list
	SAMMI.extCommand("VtubeStudio - Get Expression State",3355443, 80, {
		ExpressionFile: ["Expression File Name (Leave blank to get all)", 14, "example.exp3.json"],
		Details: ["Include Details", 2, false],
		variable: saveAsVariableBox
	});

	//ExpressionActivationRequest
	//https://github.com/DenchiSoft/VTubeStudio#requesting-activation-or-deactivation-of-expressions
	SAMMI.extCommand("VtubeStudio - Toggle Expression",3355443, 80, {
		ExpressionFile: ["Expression File Name", 14, ""],
		Active: ["Turn On? (true/false)", 15, "false"]
	});
}
//#endregion

//#region Insert Hooks
//(We don't call them that anymore)
//TODO Move to private space
function SAMMIVTS_insertCommandHooks() {
	sammiclient.on('VtubeStudio - Request Token', async (json) => {
		const data = json.Data;
		//Request a token from the VTS server and save the token it replies with to a Global variable
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			SAMMI.setVariable("SAMMIVtubeStudioExtension_AuthToken", data.authenticationToken || undefined); //Hardcoded to save to Global
		};
		createVTSWebSocketClient(() => {requestVtubeStudioAuthenticationToken({requestID: requestID});});
	});
	
	sammiclient.on('VtubeStudio - Authenticate', async (json) => {
		const data = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (data.authenticated == false) SAMMIVTS_postConsoleMessage("The VTS server failed to authenticate the extension");
			SAMMI.setVariable("SAMMIVtubeStudioExtension_IsAuthenticated", data.authenticated || false); //Hardcoded to save to Global
		};
		createVTSWebSocketClient(() => { requestAuthentication({requestID: requestID}); });
	});
	
	sammiclient.on('VtubeStudio - Send Hotkey', async (json) => {
		const SAMMIJSON = json.Data;
		const hotkey = window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`].find(h => SAMMIJSON.Hotkey.toLowerCase() === getVTSHotKeyIdentifier(h.hotkeyName.toLowerCase(), h.modelName.toLowerCase()));
		if (!!hotkey) {
			requestHotkeyTrigger(hotkey.hotkeyID);
			return;
		}
		else {
			SAMMIVTS_postSAMMIMessage(`Warning - Attempted to trigger hotkey [${SAMMIJSON.Hotkey.toLowerCase()}]. Could not identifiy hotkey.`)
			return;
		}
	});
	
	sammiclient.on('VtubeStudio - Send Hotkey (By Name)', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			var hotkey = (data.availableHotkeys || []).find(h => h.name.toLowerCase() == SAMMIJSON.HotkeyName.toLowerCase());
			if (hotkey) {
				requestHotkeyTrigger(hotkey.hotkeyID);
			}
			else {
				SAMMIVTS_postSAMMIMessage(`Warning - Attempted to trigger hotkey [${SAMMIJSON.HotkeyName.toLowerCase()}]. Could not identifiy hotkey on current model`)
			}
			window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = undefined;
		};
		requestModelHotKeys(null, requestID);
	});
	
	sammiclient.on('VtubeStudio - Send Hotkey (Item)', async (json) => {
		requestHotkeyTrigger(SAMMIJSON.Hotkey, SAMMIJSON.InstanceID);
	});
	
	sammiclient.on('VtubeStudio - Load Model', async (json) => {
		const SAMMIJSON = json.Data;
		let model = window[`${VTUBESTUDIO_PLUGINNAME}_Models`].find(m => m.modelName === SAMMIJSON.Model);
		if (!!model) {
			requestLoadModel(model.modelID);
		}
	});
	
	sammiclient.on('VtubeStudio - Move Model', async (json) => {
		const SAMMIJSON = json.Data;
		requestMoveModel(SAMMIJSON.positionX, SAMMIJSON.positionY, SAMMIJSON.rotation, SAMMIJSON.size, SAMMIJSON.time, SAMMIJSON.relative);
	});
	
	sammiclient.on('VtubeStudio - Pull Value', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (modelData) => {
			if (!!SAMMIJSON.variable) {
				//I think the model position data is inside "modelPosition" proptery, so let's extract it....
				modelData = { ...modelData, ...modelData.modelPosition };
				let buttonID = 'global';
				if (SAMMIJSON.Global !== true) {buttonID = SAMMIJSON.FromButton;}
				if (!SAMMIJSON.PullValue || SAMMIJSON.PullValue == "") {SAMMI.setVariable(SAMMIJSON.variable, modelData, buttonID); return;}
				SAMMI.setVariable(SAMMIJSON.variable, modelData[SAMMIJSON.PullValue] || undefined, buttonID);
			}
		};
		requestCurrentModelData({requestID: requestID});
	});
	
	sammiclient.on('VtubeStudio - Get Items List', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
				return;
			}
		};
		requestItemList({requestID: requestID}, SAMMIJSON.includeAvailableSpots, 
			SAMMIJSON.includeItemInstancesInScene, SAMMIJSON.includeAvailableItemFiles, 
			SAMMIJSON.onlyItemsWithFileName, SAMMIJSON.onlyItemsWithInstanceID);
	});
	
	sammiclient.on('VtubeStudio - Load Item', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
				return;
			}
		};
	
		const {fileName, positionX,positionY,size,rotation,fadeTime,order,failIfOrderTaken,
			smoothing,censored,flipped,locked,unloadWhenPluginDisconnects} = SAMMIJSON;

		requestLoadItem({requestID,fileName,positionX,positionY,size,rotation,fadeTime,
			order,failIfOrderTaken,smoothing,censored,flipped,locked,unloadWhenPluginDisconnects
		});
	});
	
	sammiclient.on('VtubeStudio - Remove Item', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
				return;
			}
		};

		const {unloadAllInScene,unloadAllLoadedByThisPlugin,allowUnloadingItemsLoadedByUserOrOtherPlugins,
			instanceIDs: instanceIDsArrayName,fileNames: fileNamesArrayName} = SAMMIJSON;
	
		SAMMI.getVariable(instanceIDsArrayName, SAMMIJSON.FromButton).then(instanceIDs => {
			SAMMI.getVariable(fileNamesArrayName, SAMMIJSON.FromButton).then(fileNames => {
				requestRemoveItem({
					requestID,
					unloadAllInScene,
					unloadAllLoadedByThisPlugin,
					allowUnloadingItemsLoadedByUserOrOtherPlugins,
					instanceIDs: instanceIDs.value,
					fileNames: fileNames.value
				});
			});
		});
	});
	
	sammiclient.on('VtubeStudio - Control Animation', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
	
		const {itemInstanceID,framerate,frame,brightness,opacity,setAutoStopFrames,autoStopFrames,setAnimationPlayState,animationPlayState} = SAMMIJSON;
	
		if (autoStopFrames && autoStopFrames !== "") {
			SAMMI.getVariable(autoStopFrames, SAMMIJSON.FromButton).then(autoStopFramesVariable => {
				requestItemAnimationControl({requestID,itemInstanceID,framerate,frame,brightness,opacity,
					setAutoStopFrames,autoStopFrames: autoStopFramesVariable.value,setAnimationPlayState,animationPlayState});
			});
			return;
		}
		
		requestItemAnimationControl({requestID,itemInstanceID,framerate,frame,brightness,opacity,setAutoStopFrames,
			autoStopFrames: null,setAnimationPlayState,animationPlayState});
	});
	
	sammiclient.on('VtubeStudio - Move Item', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
	
		const {
			itemsToMove: itemsToMoveVariableName
		} = SAMMIJSON;
	
		if (itemsToMoveVariableName && itemsToMoveVariableName !== "") {
			SAMMI.getVariable(itemsToMoveVariableName, SAMMIJSON.FromButton).then(itemsToMoveVariable => {
				requestItemMove({requestID, itemsToMove: itemsToMoveVariable.value});
			});
			return;
		}
	});
	
	sammiclient.on('VtubeStudio - Get VTS Info', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				if (!SAMMIJSON.pullValue || SAMMIJSON.pullValue == "") {SAMMI.setVariable(SAMMIJSON.variable, data, buttonID); return;}
				SAMMI.setVariable(SAMMIJSON.variable, data[SAMMIJSON.pullValue] || undefined, buttonID);
			}
		};
		requestVTSStats({requestID: requestID});
	});
	
	sammiclient.on('VtubeStudio - Get Expression State', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
			}
		};
		requestExpressionStateRequest({requestID: requestID, expressionFile: SAMMIJSON.ExpressionFile, details: SAMMIJSON.Details});
	});
	
	sammiclient.on('VtubeStudio - Toggle Expression', async (json) => {
		const SAMMIJSON = json.Data;
		requestExpressionActivationRequest({requestID: uuidv4(), expressionFile: SAMMIJSON.ExpressionFile, active: SAMMIJSON.Active});
	});
	
	sammiclient.on('VtubeStudio - Listen to Event', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				if (!SAMMIJSON.pullValue || SAMMIJSON.pullValue == "") {SAMMI.setVariable(SAMMIJSON.variable, data, buttonID); return;}
				SAMMI.setVariable(SAMMIJSON.variable, data[SAMMIJSON.pullValue] || undefined, buttonID);
			}
		};
		requestVTSEventSubscription({requestID: requestID, event: SAMMIJSON.Event});
	});
	
	sammiclient.on('VtubeStudio - Unsubscribe from Event', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				if (!SAMMIJSON.pullValue || SAMMIJSON.pullValue == "") {SAMMI.setVariable(SAMMIJSON.variable, data, buttonID); return;}
				SAMMI.setVariable(SAMMIJSON.variable, data[SAMMIJSON.pullValue] || undefined, buttonID);
			}
		};
		requestVTSEventUnSubscribe({requestID: requestID, event: SAMMIJSON.Event});
	});
	
	//#region Hooks: PostProcessing VFX
	sammiclient.on('VtubeStudio - PostProcessing List Get (BETA)', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, SAMMIJSON.FromButton);
			}
		};
		const {fillPostProcessingPresetsArray,fillPostProcessingEffectsArray, effectIDFilter: effectIDFilterArrayName} = SAMMIJSON;
		var data = {
			fillPostProcessingPresetsArray,
			fillPostProcessingEffectsArray
		}

		if (effectIDFilterArrayName && effectIDFilterArrayName !== "") {
			SAMMI.getVariable(effectIDFilterArrayName, SAMMIJSON.FromButton).then(response => {
				data.effectIDFilter = response.value;
				requestPostProcessingListRequest({requestID: requestID, data: data});
			});
			return;
		}
		requestPostProcessingListRequest({requestID: requestID, data: data});
	});
	
	sammiclient.on('VtubeStudio - PostProcessing - Helper - Add Effect to Array (BETA)', async (json) => {
		const SAMMIJSON = json.Data;
		const {effectName, variable: arrayName} = SAMMIJSON;
		await SAMMI.getVariable(arrayName, SAMMIJSON.FromButton).then(async (response) => {
			let array_value = [];
			if (!!response.value) { array_value = response.value; }
			array_value.push(effectName);
			await SAMMI.setVariable(arrayName, array_value, SAMMIJSON.FromButton);
		});
	});

	sammiclient.on('VtubeStudio - PostProcessing Simple On/Off (BETA)', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
			}
		};
		const { postProcessingOn } = SAMMIJSON;
		var data = {
			postProcessingOn
		}
		requestPostProcessingUpdateRequest({requestID: requestID, data: data});
	});

	sammiclient.on('VtubeStudio - PostProcessing - Helper - Create Config Object (BETA)', async (json) => {
		const SAMMIJSON = json.Data;
		const { configID, configValue, variable } = SAMMIJSON;
		var data = {
			configID,
			configValue
		}
		await SAMMI.setVariable(variable, data, SAMMIJSON.FromButton);
	});

	sammiclient.on('VtubeStudio - PostProcessing Set (BETA)', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
			}
		};
		const {postProcessingOn,postProcessingFadeTime,setAllOtherValuesToDefault,
			usingRestrictedEffects,randomizeAll,randomizeAllChaosLevel,postProcessingValues: postProcessingValuesArrayName} = SAMMIJSON;
		var data = {
			postProcessingOn,
			setPostProcessingPreset: false,
			setPostProcessingValues: true,
			postProcessingFadeTime,
			setAllOtherValuesToDefault,
			usingRestrictedEffects,
			randomizeAll,
			randomizeAllChaosLevel
		}
		if (postProcessingValuesArrayName && postProcessingValuesArrayName !== "") {
			SAMMI.getVariable(postProcessingValuesArrayName, SAMMIJSON.FromButton).then(response => {
				requestPostProcessingUpdateRequest({
					requestID,
					data: {
						...data,
						postProcessingValues: response.value
					}
				});
			});
			return;
		}
		
		requestPostProcessingUpdateRequest({requestID: requestID, data: data});
	});

	sammiclient.on('VtubeStudio - PostProcessing Set by Preset(BETA)', async (json) => {
		const SAMMIJSON = json.Data;
		const requestID = uuidv4();
		window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][requestID] = (data) => {
			if (!!SAMMIJSON.variable) {
				let buttonID = SAMMIJSON.FromButton;
				SAMMI.setVariable(SAMMIJSON.variable, data, buttonID);
			}
		};
		const {postProcessingOn,presetToSet,postProcessingFadeTime,setAllOtherValuesToDefault,
			usingRestrictedEffects,randomizeAll,randomizeAllChaosLevel,postProcessingValues: postProcessingValuesArrayName} = SAMMIJSON;
		var data = {
			postProcessingOn,
			setPostProcessingPreset: true,
			setPostProcessingValues: false,
			presetToSet,
			postProcessingFadeTime,
			setAllOtherValuesToDefault,
			usingRestrictedEffects,
			randomizeAll,
			randomizeAllChaosLevel
		}
		if (postProcessingValuesArrayName && postProcessingValuesArrayName !== "") {
			SAMMI.getVariable(postProcessingValuesArrayName, SAMMIJSON.FromButton).then(response => {
				requestPostProcessingUpdateRequest({
					requestID,
					data: {
						...data,
						postProcessingValues: response.value
					}
				});
			});
			return;
		}
		
		requestPostProcessingUpdateRequest({requestID: requestID, data: data});
	});
	//#endregion Hooks: PostProcessing VFX
}
//#endregion

//#region Interpret API Response
//This is the master logic for recieving responses from the VTS server
//TODO Move to private space
function interpretResponse(responseData) {
	if (!responseData) { throw 'interpretResponse: responseData cannot be null!'; }
	console.debug("Received Message of Type: " + responseData.messageType)
	switch(responseData.messageType) {
		case "AuthenticationTokenResponse":
			window.VTUBESTUDIO_AUTHTOKEN = responseData.data.authenticationToken;
			if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data);
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
			}
			break;
		case "AuthenticationResponse":
			SAMMIVTS_postSAMMIMessage(`Response from server: ${responseData.data.reason}`);

			window.VTUBESTUDIO_AUTHTOKEN = responseData.data.authenticationToken;
			if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data);
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
			}

			if (responseData.data.authenticated === true) {
				requestListOfModels();
			}
			break;
		case "AvailableModelsResponse":
			SAMMIVTS_postConsoleMessage(`Found ${responseData.data.numberOfModels} models.`);
			window[`${VTUBESTUDIO_PLUGINNAME}_Models`] = responseData.data.availableModels;
			window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`] = [];

			SAMMI.extCommand("VtubeStudio - Load Model",3355443, 52, { 
				Model: ['Model to Load', 20, "Please make a selection", null, window[`${VTUBESTUDIO_PLUGINNAME}_Models`].map(m => `${m.modelName}`)]
			})
			
			//TODO Eesh, race condition maybe. Find a better way
			for(let index = 0; index < window[`${VTUBESTUDIO_PLUGINNAME}_Models`].length; index++) {
				setTimeout(() => {requestModelHotKeys(responseData.data.availableModels[index].modelID);}, 50);
			}
			break;
		case "HotkeysInCurrentModelResponse":
			SAMMIVTS_postConsoleMessage(`Found ${responseData.data.availableHotkeys.length} hotkeys for ${responseData.data.modelName}`);
			
			if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data);
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
			}
			else {
				window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`] = window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`].concat(responseData.data.availableHotkeys.filter(hotkey => !!hotkey.name && hotkey.name !== "").map(hotkey => { 
					return {
						hotkeyName: hotkey.name.toLowerCase(), 
						hotkeyID: hotkey.hotkeyID, 
						modelName: responseData.data.modelName.toLowerCase()
					}; 
				}));
	
				SAMMI.extCommand("VtubeStudio - Send Hotkey",3355443, 52, {
					Hotkey: ['Hotkey', 20, "Please make a selection", null, window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`].map(hotkey => getVTSHotKeyIdentifier(hotkey.hotkeyName.toLowerCase(), hotkey.modelName.toLowerCase()))]
				  });
			}
			break;
		case "HotkeyTriggerResponse":
			SAMMIVTS_postSAMMIMessage(`Triggered hotkey`);
			break;
		case "ModelLoadResponse":
			SAMMIVTS_postSAMMIMessage(`Model loaded`);
			break;
		case "MoveModelResponse":
			break;
		case "ItemLoadResponse":
			if (responseData.data && responseData.data.instanceID) {
				//SAMMIVTS_postConsoleMessage("ItemListResponse SUCCESS: " + responseData.data.instanceID)
				if (!responseData.requestID) { console.error("The supplied API response did not include a requestID", responseData); }
				if (!window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
					console.error("The supplied API repsonse included a request ID that did not match any callbacks in the _OnMessageRecievedFunctions collection.\n This response will not produce any effects in SAMMI.");
				}
				if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
						window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data.instanceID);
						window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
				}
			}
			break;
		case "ItemUnloadResponse":
			if (responseData.data && responseData.data.unloadedItems) {
				//SAMMIVTS_postConsoleMessage("ItemUnloadResponse SUCCESS: " + responseData.data.unloadedItems)
				if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
						window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data.instanceID);
						window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
				}
			}
			break;
		case "ItemAnimationControlResponse":
			if (responseData.data && responseData.data.animationPlaying !== undefined) {
				//SAMMIVTS_postSAMMIMessage("ItemAnimationControlResponse SUCCESS");
			}
			break;
		case "ItemMoveResponse":
			if (responseData.data && responseData.data.movedItems) {
				//SAMMIVTS_postSAMMIMessage("ItemMoveResponse SUCCESS");
			}
			break;
		case "ItemListResponse":
		case "CurrentModelResponse":
		case "StatisticsResponse":
		case "ExpressionStateResponse":
		case "PostProcessingListResponse":
		case "PostProcessingUpdateResponse":
			if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data);
				window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
			}
			break;
		case "ExpressionActivationResponse":
			//Nothing happens with this
			//https://github.com/DenchiSoft/VTubeStudio#requesting-activation-or-deactivation-of-expressions
			SAMMIVTS_postSAMMIMessage(`Triggered Expression`);
			break;
		//#region Event Subscriptions
		case "EventSubscriptionResponse":
			if (window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID]) {
						window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID](responseData.data);
						window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`][responseData.requestID] = undefined;
				}
			break;
		case "TestEvent":
		case "ModelLoadedEvent":
		case "TrackingStatusChangedEvent":
		case "BackgroundChangedEvent":
		case "ModelConfigChangedEvent":
		case "ModelMovedEvent":
		case "ModelOutlineEvent":
			if (responseData.data) {
				SAMMI.triggerExt(`VTSEvent - ${responseData.messageType}`, { ...responseData.data });
			}
			break;
		//#endregion Event Subscriptions
		case 'APIError':
			SAMMIVTS_postSAMMIMessage("Received an error from the API: " + responseData.data.errorID + ": " + responseData.data.message);
			break;
		default:
			SAMMIVTS_postSAMMIMessage("Received an unknown message type: " + responseData.messageType + ". The handler for this event has not been implemented.");
			break;
	}
}
//#endregion

//Create the socket by which to faciliate comms with VTS with
//TODO Move to private space
function createVTSWebSocketClient(callback = null) {
	SAMMIVTS_postSAMMIMessage('Checking client');
	if (!window.VTUBESTUDIO_WebSocket || window.VTUBESTUDIO_WebSocket.readyState === VTUBESTUDIO_WebSocket_ReadyStates.CLOSED) {
		window.VTUBESTUDIO_WebSocket = new WebSocket(VTUBESTUDIO_SERVER);

		//Add Event Handlers
		window.VTUBESTUDIO_WebSocket.onmessage = function(event) {
			if (event.data) {
				const responseData = JSON.parse(event.data);
				interpretResponse(responseData);
			} else {
				SAMMIVTS_postSAMMIMessage("Response data was empty", 1);
			}
		}
		
		window.VTUBESTUDIO_WebSocket.onclose = function(event) {
			SAMMIVTS_postConsoleMessage(`Disconnected(${event.code || "No code provided"}, ${event.reason || "No reason provided"}), reconnecting in 5 seconds`);
			SAMMIVTS_postSAMMIMessage('Socket disconnected, reconnecting in 5 seconds');
			setTimeout(createVTSWebSocketClient, 5000);
		}

		window.VTUBESTUDIO_WebSocket.onopen = function(event) {
			if (callback) callback();
		}
		return;
	}
	else if (window.VTUBESTUDIO_WebSocket.readyState === VTUBESTUDIO_WebSocket_ReadyStates.CLOSING) {
		SAMMIVTS_postConsoleMessage(`Closure pending, waiting 5 seconds to reopen`);
		setTimeout(() => { createVTSWebSocketClient(callback); }, 5000);
		return;
	}

	if (callback) callback();
}

//#region Request Functions
//TODO Move to private space
function sendMessageToVtubeStudio(request) {
	//TODO Need better retry logic, maybe implement a queuing system? Also, how do you spell that word?
	if (window.VTUBESTUDIO_WebSocket) {
		if ( window.VTUBESTUDIO_WebSocket.readyState == VTUBESTUDIO_WebSocket_ReadyStates.OPEN) {
			const str = JSON.stringify(request);
			const bytes = new TextEncoder().encode(str);
			const blob = new Blob([bytes], {
				type: "application/json;charset=utf-8"
			});
			window.VTUBESTUDIO_WebSocket.send(blob);
		} else { //Socket was not open???!!!?!?! Uh......;;;;
			SAMMIVTS_postSAMMIMessage('Connection pending(' + window.VTUBESTUDIO_WebSocket.readyState + ')');
			if (window.VTUBESTUDIO_WebSocket.readyState == VTUBESTUDIO_WebSocket_ReadyStates.CLOSING) {
				setTimeout(createVTSWebSocketClient, 5000);
			} else if (window.VTUBESTUDIO_WebSocket.readyState == VTUBESTUDIO_WebSocket_ReadyStates.CLOSED) {
				createVTSWebSocketClient();
			} else if (window.VTUBESTUDIO_WebSocket.readyState == VTUBESTUDIO_WebSocket_ReadyStates.OPENING) {
				setTimeout(() => { sendMessageToVtubeStudio(request); }, 3000);
			}
		}
	} else {
		SAMMIVTS_postSAMMIMessage(`Websocket not instantiated`);
		createVTSWebSocketClient();
	}
};

//TODO Move to private space
async function requestVtubeStudioAuthenticationToken({requestID}) {
	SAMMIVTS_postSAMMIMessage('Plugin is asking for authentication in VTube Studio', 0);
	const request = await SAMMIVTS_generateBaseRequest("AuthenticationTokenRequest");
	request.requestID = requestID;
	request.data.pluginIcon = VTUBESTUDIO_PLUGIN_ICON64;
	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestAuthentication({requestID}) {
	let request = await SAMMIVTS_generateBaseRequest("AuthenticationRequest");
	request.requestID = requestID;
	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestListOfModels() {
	let request = await SAMMIVTS_generateBaseRequest("AvailableModelsRequest");
	sendMessageToVtubeStudio(request);

}

//TODO Move to private space
async function requestModelHotKeys(modelID = null, requestID = null) {
	let request = await SAMMIVTS_generateBaseRequest("HotkeysInCurrentModelRequest");
	request.data.modelID = modelID;
	if (requestID) request.requestID = requestID;
	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestHotkeyTrigger(hotkeyID, instanceID = null) {
	let request = await SAMMIVTS_generateBaseRequest("HotkeyTriggerRequest");
	request.data.hotkeyID = hotkeyID;
	if (instanceID) {
		request.data.itemInstanceID = instanceID;
	}
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestItemList(obj, includeAvailableSpots = false, includeItemInstancesInScene = false, includeAvailableItemFiles = false, onlyItemsWithFileName = "", onlyItemsWithInstanceID = "") {
	let request = await SAMMIVTS_generateBaseRequest("ItemListRequest");
	request = {...request, ...obj};
	request.data = {
		...request.data,
		"includeAvailableSpots": includeAvailableSpots,
		"includeItemInstancesInScene": includeItemInstancesInScene,
		"includeAvailableItemFiles": includeAvailableItemFiles,
		"onlyItemsWithFileName": onlyItemsWithFileName,
		"onlyItemsWithInstanceID": onlyItemsWithInstanceID
	};
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestLoadItem(
	{
		requestID,
		fileName,
		positionX,
		positionY,
		size,
		rotation,
		fadeTime,
		order,
		failIfOrderTaken,
		smoothing,
		censored,
		flipped,
		locked,
		unloadWhenPluginDisconnects
	} = { 
		positionX: 0,
		positionY: 0.5,
		size: 0.33,
		rotation: 90,
		fadeTime: 0.5,
		order: 4,
		failIfOrderTaken: false,
		smoothing: 0,
		censored: false,
		flipped: false,
		locked: false,
		unloadWhenPluginDisconnects: true 
	}) {

	if (!fileName) return;
	let request = await SAMMIVTS_generateBaseRequest("ItemLoadRequest");
	request.requestID = requestID;
	request.data = {
		...request.data,
		fileName,
		positionX,
		positionY,
		size,
		rotation,
		fadeTime,
		order,
		failIfOrderTaken,
		smoothing,
		censored,
		flipped,
		locked,
		unloadWhenPluginDisconnects
	};
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestRemoveItem({
	requestID,
	unloadAllInScene,
	unloadAllLoadedByThisPlugin,
	allowUnloadingItemsLoadedByUserOrOtherPlugins,
	instanceIDs,
	fileNames
} = {
	unloadAllInScene: false,
	unloadAllLoadedByThisPlugin: false,
	allowUnloadingItemsLoadedByUserOrOtherPlugins: true,
	instanceIDs: [],
	fileNames: []
}) {
	let request = await SAMMIVTS_generateBaseRequest("ItemUnloadRequest");
	request.requestID = requestID;
	request.data = {
		...request.data,
		unloadAllInScene,
		unloadAllLoadedByThisPlugin,
		allowUnloadingItemsLoadedByUserOrOtherPlugins,
		instanceIDs,
		fileNames
	};
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestItemAnimationControl({
	requestID,
	itemInstanceID,
	framerate,
	frame,
	brightness,
	opacity,
	setAutoStopFrames,
	autoStopFrames,
	setAnimationPlayState,
	animationPlayState
  } = {
	framerate: 12,
	frame: 3,
	brightness: 1,
	opacity: 1,
	setAutoStopFrames: true,
	autoStopFrames: [
	  0,
	  7,
	  26
	],
	setAnimationPlayState: true,
	animationPlayState: true
  }
  ) {
	let request = await SAMMIVTS_generateBaseRequest("ItemAnimationControlRequest");
	request.requestID = requestID;
	request.data = {
		...request.data,
		itemInstanceID,
		framerate,
		frame,
		brightness,
		opacity,
		setAutoStopFrames,
		autoStopFrames,
		setAnimationPlayState,
		animationPlayState
	};
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestItemMove({requestID, itemsToMove}) {
	if (itemsToMove.length < 1) return;
	if (typeof itemsToMove[0] == "string") itemsToMove = itemsToMove.map(e => { return JSON.parse(e) });
	let request = await SAMMIVTS_generateBaseRequest("ItemMoveRequest");
	request.requestID = requestID;
	request.data = {
		...request.data,
		itemsToMove
	}
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestLoadModel(modelID) {
	if (!modelID) { throw "modelID cannot be null or undefined" }
	let request = await SAMMIVTS_generateBaseRequest("ModelLoadRequest");
	request.data.modelID = modelID;
	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestMoveModel(posX = null, posY = null, rotation = null, size = null, time = 0.2, relativeValues = false) {
	let request = await SAMMIVTS_generateBaseRequest("MoveModelRequest");
	request.data = {
		timeInSeconds: time,
		valuesAreRelativeToModel: relativeValues,
		positionX: posX,
		positionY: posY,
		rotation: rotation,
		size: size,
	}
	sendMessageToVtubeStudio(request);
}

//TODO I feel like some of these are just the same function over and over with slight differences
//TODO Move to private space
async function requestCurrentModelData(obj) {
	let request = await SAMMIVTS_generateBaseRequest("CurrentModelRequest");
	request = {...request, ...obj};
	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestVTSStats({requestID}) {
	let request = await SAMMIVTS_generateBaseRequest("StatisticsRequest");
	request.requestID = requestID;
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
//https://github.com/DenchiSoft/VTubeStudio#requesting-current-expression-state-list
async function requestExpressionStateRequest({requestID, expressionFile, details}) {
	let request = await SAMMIVTS_generateBaseRequest("ExpressionStateRequest");
	request.requestID = requestID;
	request.data.details = details;
	request.data.expressionFile = expressionFile;
	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
//https://github.com/DenchiSoft/VTubeStudio#requesting-activation-or-deactivation-of-expressions
async function requestExpressionActivationRequest({requestID, expressionFile, active}) {
	let request = await SAMMIVTS_generateBaseRequest("ExpressionActivationRequest");
	request.requestID = requestID;
	request.data.active = active;
	request.data.expressionFile = expressionFile;
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
//https://github.com/DenchiSoft/VTubeStudio?tab=readme-ov-file#set-post-processing-effects
async function requestPostProcessingUpdateRequest({requestID, data}) {
	let request = await SAMMIVTS_generateBaseRequest("PostProcessingUpdateRequest");
	request.requestID = requestID;
	request.data = data;
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
//https://github.com/DenchiSoft/VTubeStudio?tab=readme-ov-file#get-list-of-post-processing-effects-and-state
async function requestPostProcessingListRequest({requestID, data}) {
	let request = await SAMMIVTS_generateBaseRequest("PostProcessingListRequest");
	request.requestID = requestID;
	request.data = data;
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
function requestRefresh() {
	SAMMIVTS_postSAMMIMessage("Refreshing model and hotkey list");
	requestListOfModels();
}
//#endregion End Request Functions for VTS

//#region Helper Functions
//TODO Move to private space
async function SAMMIVTS_getVTSAuthToken() {
	let token = null;
	await SAMMI.getVariable("SAMMIVtubeStudioExtension_AuthToken", "global").then(tokenObj => {
		token = tokenObj.Value; //I am not sure where this is Value, but others produce value
	});
	return token;
}

//TODO Move to private space
async function SAMMIVTS_generateBaseRequest (messageType) {
	let token = await SAMMIVTS_getVTSAuthToken();
	if (messageType !== "AuthenticationTokenRequest" && !token) SAMMIVTS_postSAMMIMessage("Warning - Token is missing. Command will not work.")
	return {
		"apiName": "VTubeStudioPublicAPI",
		"apiVersion": "1.0",
		"requestID": uuidv4(),
		"messageType": messageType,
		"data": {
			"pluginName": VTUBESTUDIO_PLUGINNAME,
			"pluginDeveloper": VTUBESTUDIO_AUTHORNAME,
			"pluginIcon": VTUBESTUDIO_PLUGIN_ICON64,
			"authenticationToken": token //window.VTUBESTUDIO_AUTHTOKEN
		}
	};
}

//TODO Move to private space
async function requestVTSEventSubscription({requestID, event}) {
	let request = await SAMMIVTS_generateBaseRequest("EventSubscriptionRequest");
	request.requestID = requestID;
	request.data = {
		"eventName": event,
		"subscribe": true,
		"config": {
			"testMessageForEvent": "Hit Hue"
		}
	};
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
async function requestVTSEventUnSubscribe({requestID, event}) {
	let request = await SAMMIVTS_generateBaseRequest("EventSubscriptionRequest");
	request.requestID = requestID;
	request.data = {
		"eventName": event,
		"subscribe": false,
		"config": {}
	};
  	sendMessageToVtubeStudio(request);
}

//TODO Move to private space
function uuidv4() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
    });
}

//TODO Move to private space
function SAMMIVTS_postSAMMIMessage(message, level = 1) {
	switch(level) {
		case 0:
			SAMMI.notification("VTUBESTUDIO: " + message);
			break;
		case 1:
			SAMMI.alert("VTUBESTUDIO: " + message);
			break;
	}
}

//TODO Move to private space
function SAMMIVTS_postConsoleMessage(message) {
	console.debug(`${VTUBESTUDIO_PLUGINNAME}: ${message}`);
}

//TODO Move to private space
function getVTSHotKeyIdentifier(hotkeyName, modelName) {
	return `${hotkeyName.toLowerCase()} - (${modelName.toLowerCase()})`;
}
//#endregion  Helper Functions

function SAMMIVTS_initialize() {
	if (sammiclient) {
		SAMMIVTS_postSAMMIMessage("Started $!BUILDNUMBER!$");
		if (!window[`${VTUBESTUDIO_PLUGINNAME}_Space`]) window[`${VTUBESTUDIO_PLUGINNAME}_Space`] = {};
		if (!window[`${VTUBESTUDIO_PLUGINNAME}_Models`]) window[`${VTUBESTUDIO_PLUGINNAME}_Models`] = [];
		if (!window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`]) window[`${VTUBESTUDIO_PLUGINNAME}_HotKeys`] = [];
		if (!window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`]) window[`${VTUBESTUDIO_PLUGINNAME}_OnMessageRecievedFunctions`] = [];
		SAMMIVTS_insertBaseCommands();
		SAMMIVTS_insertCommandHooks();
		return;
	}

	if (!sammiclient) {
		setTimeout(SAMMIVTS_initialize, 1000);
		return;
	}
}

[insert_over]
{"exampleDeckData":"$!ExampleDeckData!$"}